<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
  <head>
    <title>Poliplanner</title>
  </head>
  <main layout:fragment="content">
    <!-- Encabezado y selector -->
    <div class="header-selector">
      <h1>Mis horarios</h1>
      <div th:if="${not schedules?.empty}" class="form-container">
        <!-- Form para seleccionar horario -->
        <form id="scheduleForm" th:action="@{/}" method="get">
          <select id="scheduleSelector" name="id" onchange="this.form.submit()" aria-label="Seleccionar horario">
            <option value="" selected disabled>Selecciona un horario</option>
            <option th:each="schedule : ${schedules}"
                    th:value="${schedule.id}"
                    th:text="${schedule.description}"
                    th:selected="${selectedSchedule != null and selectedSchedule.id == schedule.id}">
            </option>
          </select>
        </form>
        <!-- Form para eliminar horario -->
        <form id="deleteScheduleForm" th:action="@{/schedule/{id}/delete(id=${selectedSchedule.id})}" method="post"
              th:if="${selectedSchedule != null}" onsubmit="return confirm('¿Estás seguro que quieres eliminar este horario?');">
          <button type="submit" class="error" aria-label="Eliminar horario">
            <i class="bi bi-trash"></i>
          </button>
        </form>
      </div>
    </div>
    <!-- Mensajes -->
    <div th:if="${error}">
      <div th:replace="~{fragments/alerts/error :: alert(${error})}"></div>
    </div>
    <div th:if="${success}">
      <div th:replace="~{fragments/alerts/success :: alert(${success})}"></div>
    </div>
    <div th:if="${hasNewExcel}">
      <div th:replace="~{fragments/alerts/warning :: alert(${hasNewExcel})}"></div>
    </div>
    <div th:if="${warning}">
      <div th:replace="~{fragments/alerts/warning :: alert(${warning})}"></div>
    </div>
    <div th:if="${schedules?.empty}">
      No tienes horarios registrados.
    </div>
    <section>
      <!-- Contenido del horario seleccionado -->
      <div th:replace="~{pages/dashboard/detail :: schedule(${selectedSchedule})}"
            th:if="${selectedSchedule != null}">
      </div>
      <div id="bottom"></div>
    </section>
    <style>
      /* Estilos para página de dashboard */
      .header-selector {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--space-xl);
          padding: var(--space-md);
          background-color: color-mix(in srgb, var(--color-bg), var(--color-secondary-bg) 20%);
          flex-wrap: wrap;
      }

      .form-container {
          display: flex;
          align-items: center;
          gap: var(--space-md);
      }

      #scheduleSelector {
          width: 250px;
          padding: var(--space-sm);
          font-size: var(--font-size-base);
          font-weight: var(--font-weight-normal);
          border: 1px solid var(--color-border);
          border-radius: 0.25rem;
          background-color: color-mix(in srgb, var(--color-bg), var(--color-secondary-bg) 10%);
          color: var(--color-text);
          transition: border-color 0.2s ease, outline 0.2s ease;
      }

      #scheduleSelector:focus {
          outline: 2px solid var(--color-primary);
          outline-offset: 1px;
          border-color: var(--color-primary);
      }

      @media (max-width: 768px) {
          .header-selector {
              flex-direction: column;
              align-items: flex-start;
              gap: var(--space-md);
          }

          .form-container {
              width: 100%;
              gap: var(--space-sm);
          }

          #scheduleSelector {
              width: 100%;
          }
      }
    </style>
  </main>
</html>
