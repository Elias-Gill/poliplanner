<div th:fragment="schedule(schedule)">
  <div th:if="${schedule}">
    <!-- Tabla de horarios -->
    <div class="table-container" th:if="${not schedule.materias?.empty}">
      <table>
        <thead>
          <tr>
            <th>Materia</th>
            <th>Lunes</th>
            <th>Martes</th>
            <th>Miércoles</th>
            <th>Jueves</th>
            <th>Viernes</th>
            <th>Sábado</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="materia : ${schedule.materias}">
            <td class="strong" th:text="${materia.nombreAsignatura}"></td>
            <!-- Lunes -->
            <td th:if="${materia.lunes != null and materia.lunes != ''}">
              <div th:text="${materia.lunes}"></div>
              <div class="subtext" th:if="${materia.aulaLunes != null}" 
                th:text="'Aula: ' + ${materia.aulaLunes}"></div>
            </td>
            <td th:if="${materia.lunes == null or materia.lunes == ''}"></td>
            <!-- Martes -->
            <td th:if="${materia.martes != null and materia.martes != ''}">
              <div th:text="${materia.martes}"></div>
              <div class="subtext" th:if="${materia.aulaMartes != null}" 
                th:text="'Aula: ' + ${materia.aulaMartes}"></div>
            </td>
            <td th:if="${materia.martes == null or materia.martes == ''}"></td>
            <!-- Miércoles -->
            <td th:if="${materia.miercoles != null and materia.miercoles != ''}">
              <div th:text="${materia.miercoles}"></div>
              <div class="subtext" th:if="${materia.aulaMiercoles != null}" 
                th:text="'Aula: ' + ${materia.aulaMiercoles}"></div>
            </td>
            <td th:if="${materia.miercoles == null or materia.miercoles == ''}"></td>
            <!-- Jueves -->
            <td th:if="${materia.jueves != null and materia.jueves != ''}">
              <div th:text="${materia.jueves}"></div>
              <div class="subtext" th:if="${materia.aulaJueves != null}" 
                th:text="'Aula: ' + ${materia.aulaJueves}"></div>
            </td>
            <td th:if="${materia.jueves == null or materia.jueves == ''}"></td>
            <!-- Viernes -->
            <td th:if="${materia.viernes != null and materia.viernes != ''}">
              <div th:text="${materia.viernes}"></div>
              <div class="subtext" th:if="${materia.aulaViernes != null}" 
                th:text="'Aula: ' + ${materia.aulaViernes}"></div>
            </td>
            <td th:if="${materia.viernes == null or materia.viernes == ''}"></td>
            <!-- Sábado -->
            <td th:if="${materia.sabado != null and materia.sabado != ''}">
              <div th:text="${materia.sabado}"></div>
              <div class="subtext" th:if="${materia.fechasSabadoNoche != null}" 
                th:text="'Fechas: ' + ${materia.fechasSabadoNoche}"></div>
            </td>
            <td th:if="${materia.sabado == null or materia.sabado == ''}"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div th:if="${schedule.materias?.empty}" class="center text-muted">
      No hay materias en este horario
    </div>
    <!-- Lista de exámenes -->
    <h1>Próximos exámenes</h1>
    <section class="exam-list">
      <!-- Primer Parcial -->
      <div th:if="${not schedule.materias.?[exams.parcial1Fecha != null].empty}">
        <h2>Primer Parcial</h5>
        <div th:each="materia : ${schedule.materias.?[exams.parcial1Fecha != null]}">
          <article>
            <span th:text="${materia.nombreAsignatura}"></span>
            <span>
              <span class="date-badge" 
th:text="${#temporals.format(materia.exams.parcial1Fecha, 'dd/MM/yyyy')}">
              </span>
              <span class="date-badge bg-warning"
th:text="${materia.exams.parcial1Hora} + 'hs'">
              </span>
            </span>
            <div th:if="${materia.exams.parcial1Aula != null}">
              Aula: <span th:text="${materia.exams.parcial1Aula}"></span>
            </div>
          </article>
        </div>
      </div>
      <!-- Segundo Parcial -->
      <div th:if="${not schedule.materias.?[exams.parcial2Fecha != null].empty}">
        <h2>Segundo Parcial</h5>
        <div th:each="materia : ${schedule.materias.?[exams.parcial2Fecha != null]}">
          <article>
            <span th:text="${materia.nombreAsignatura}"></span>
            <span>
              <span class="date-badge" 
                          th:text="${#temporals.format(materia.exams.parcial2Fecha, 'dd/MM/yyyy')}">
              </span>
              <span class="date-badge bg-warning"
                          th:text="${materia.exams.parcial2Hora} + 'hs'">
              </span>
            </span>
            <div th:if="${materia.exams.parcial2Aula != null}">
              Aula: <span th:text="${materia.exams.parcial2Aula}"></span>
            </div>
          </article>
        </div>
      </div>
      <!-- Primer final -->
      <div th:if="${not schedule.materias.?[exams.final1Fecha != null].empty}">
        <h2>Segundo Parcial</h5>
        <div th:each="materia : ${schedule.materias.?[exams.final1Fecha != null]}">
          <article>
            <span th:text="${materia.nombreAsignatura}"></span>
            <span>
              <span class="date-badge" 
                          th:text="${#temporals.format(materia.exams.final1Fecha, 'dd/MM/yyyy')}">
              </span>
              <span class="date-badge bg-warning"
                          th:text="${materia.exams.final1Hora} + 'hs'">
              </span>
            </span>
            <div th:if="${materia.exams.final1Aula != null}">
              Aula: <span th:text="${materia.exams.final1Aula}"></span>
            </div>
          </article>
        </div>
      </div>
      <!-- Segundo final -->
      <div th:if="${not schedule.materias.?[exams.final2Fecha != null].empty}">
        <h2>Segundo Final</h5>
        <div th:each="materia : ${schedule.materias.?[exams.final2Fecha != null]}">
          <article>
            <span th:text="${materia.nombreAsignatura}"></span>
            <span>
              <span class="date-badge" 
                          th:text="${#temporals.format(materia.exams.final2Fecha, 'dd/MM/yyyy')}">
              </span>
              <span class="date-badge bg-warning"
                          th:text="${materia.exams.final2Hora} + 'hs'">
              </span>
            </span>
            <div th:if="${materia.exams.final2Aula != null}">
              Aula: <span th:text="${materia.exams.final2Aula}"></span>
            </div>
          </article>
        </div>
      </div>
    </section>
    <!-- Información adicional de las materias -->
    <section th:if="${not schedule.materias?.empty}">
      <h1 class="section">Información adicional</h1>
      <div class="grid-2">
        <div th:each="materia : ${schedule.materias}" class="info-card">
          <div class="card-body">
            <h5 th:text="${materia.nombreAsignatura}" class="card-title"></h5>
            <p class="card-text">
              <span th:if="${materia.nombreProfesor}" 
                    th:text="'Profesor: ' + ${materia.tituloProfesor} + ' ' + ${materia.apellidoProfesor} + ', ' + ${materia.nombreProfesor}">
              </span><br>
              <span th:if="${materia.emailProfesor}" 
                    th:text="'Email: ' + ${materia.emailProfesor}"></span><br>
              <span th:if="${materia.seccion}" 
                    th:text="'Sección: ' + ${materia.seccion}"></span>
            </p>
          </div>
        </div>
      </div>
    </section>
    <style layout:fragment="custom_style">
      .table-container {
          overflow-x: auto;
          margin-bottom: 2rem;
      }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        th, td {
            border: 1px solid var(--border-color, #ddd);
            padding: 0.5rem;
            vertical-align: middle;
        }

        thead {
            background-color: var(--table-head-bg, #f5f5f5);
        }

        .strong {
            font-weight: bold;
        }

        .subtext {
            font-size: 0.875em;
            color: var(--text-muted, #666);
        }

        .center {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .exam-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .margin-top-lg {
            margin-top: 2rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .info-card {
            border: 1px solid var(--border-color, #ccc);
            border-radius: 0.5rem;
            padding: 1rem;
            background: var(--card-bg, #fff);
        }

        .card-title {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .card-text {
            font-size: 0.95rem;
        }
    </style>
